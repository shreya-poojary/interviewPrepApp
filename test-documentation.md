# Test Documentation

This document provides comprehensive information about the test suite for the AI Mock Interview Prep Tool.

## Test Structure

The test suite is organized into several categories:

### 1. Unit Tests
- **Location**: `src/test/java/com/interviewprep/service/`
- **Purpose**: Test individual service classes in isolation
- **Coverage**: Core business logic, data persistence, AI service interactions

#### Test Files:
- `OllamaServiceTest.java` - Tests for Ollama AI service
- `BedrockServiceTest.java` - Tests for AWS Bedrock service
- `StorageServiceTest.java` - Tests for data persistence
- `AIServiceManagerTest.java` - Tests for AI service management
- `InterviewServiceTest.java` - Tests for interview logic

### 2. Integration Tests
- **Location**: `src/test/java/com/interviewprep/integration/`
- **Purpose**: Test complete workflows and service interactions
- **Coverage**: End-to-end scenarios, data flow, error handling

#### Test Files:
- `IntegrationTestSuite.java` - Comprehensive integration tests

### 3. UI Component Tests
- **Location**: `src/test/java/com/interviewprep/ui/`
- **Purpose**: Test UI components and user interactions
- **Coverage**: Main frame, panels, event handling

#### Test Files:
- `MainFrameTest.java` - Tests for main application window

### 4. Test Utilities
- **Location**: `src/test/java/com/interviewprep/util/`
- **Purpose**: Common test helpers and mock objects
- **Coverage**: Test data creation, assertions, utilities

#### Test Files:
- `TestUtils.java` - Utility methods for creating test objects

## Running Tests

### Prerequisites
- Java 11 or higher
- Maven 3.6+
- For integration tests: Ollama service (optional)

### Quick Start

#### Windows:
```bash
run-tests.bat
```

#### Linux/macOS:
```bash
./run-tests.sh
```

#### Maven Commands:

**Run all unit tests:**
```bash
mvn test
```

**Run integration tests:**
```bash
mvn verify -Pintegration-tests
```

**Run specific test class:**
```bash
mvn test -Dtest=OllamaServiceTest
```

**Run tests with coverage:**
```bash
mvn clean test jacoco:report
```

**Generate test reports:**
```bash
mvn test -Ptest-reports
```

## Test Configuration

### Logging
- Test logs are configured in `src/test/resources/logback-test.xml`
- Console output shows test progress
- File logs are saved to `target/test-logs/test.log`

### Test Data
- Test data is stored in `target/test-data/` directory
- Each test run creates a clean environment
- Test data is automatically cleaned up after tests

### Mock Services
- Unit tests use Mockito for mocking external dependencies
- Integration tests can use real services when available
- Fallback behavior when services are unavailable

## Test Categories

### Unit Tests (Fast)
- **Execution Time**: < 1 second per test
- **Dependencies**: None (mocked)
- **Purpose**: Test individual methods and classes
- **Run Command**: `mvn test`

### Integration Tests (Slow)
- **Execution Time**: 5-30 seconds per test
- **Dependencies**: AI services, file system
- **Purpose**: Test complete workflows
- **Run Command**: `mvn verify -Pintegration-tests`

### UI Tests (Medium)
- **Execution Time**: 1-5 seconds per test
- **Dependencies**: Swing framework
- **Purpose**: Test user interface components
- **Run Command**: `mvn test -Dtest="*UITest"`

## Test Coverage

### Current Coverage Targets:
- **Overall**: 70%+ instruction coverage
- **Services**: 80%+ coverage
- **Critical Paths**: 90%+ coverage

### Coverage Reports:
- **Location**: `target/site/jacoco/index.html`
- **Generated by**: JaCoCo Maven plugin
- **Updated**: After each test run

## Continuous Integration

### GitHub Actions
- **Workflow**: `.github/workflows/test.yml`
- **Triggers**: Push to main/develop, Pull requests
- **Platforms**: Windows, Ubuntu, macOS
- **Java Versions**: 11, 17, 21

### Test Artifacts:
- Test results: `target/surefire-reports/`
- Coverage reports: `target/site/jacoco/`
- Integration test logs: `target/test-logs/`

## Troubleshooting

### Common Issues:

#### 1. Tests Failing Due to Missing Services
**Problem**: Integration tests fail when AI services are unavailable
**Solution**: Tests are designed to skip gracefully when services are unavailable

#### 2. Mockito Injection Errors
**Problem**: `Failed to inject mock client` errors
**Solution**: Ensure test classes use `@ExtendWith(MockitoExtension.class)`

#### 3. File Permission Errors
**Problem**: Cannot create test data directories
**Solution**: Ensure write permissions in project directory

#### 4. Memory Issues
**Problem**: OutOfMemoryError during tests
**Solution**: Increase heap size: `mvn test -DargLine="-Xmx2048m"`

### Debug Mode:
```bash
mvn test -Dtest=TestClassName -Dmaven.surefire.debug
```

### Verbose Output:
```bash
mvn test -X
```

## Test Data Management

### Test Objects:
- `TestUtils.createTestSession()` - Creates test interview sessions
- `TestUtils.createTestAnalytics()` - Creates test analytics
- `TestUtils.createTestResumeAnalysis()` - Creates test resume analysis

### Mock Responses:
- `TestUtils.createTestQuestionGenerationResponse()` - AI response for questions
- `TestUtils.createTestResumeAnalysisResponse()` - AI response for resume analysis
- `TestUtils.createTestAnalyticsResponse()` - AI response for analytics

### Cleanup:
- Test data is automatically cleaned up after each test
- Temporary files are removed
- Database files are deleted

## Best Practices

### Writing Tests:
1. **Arrange-Act-Assert** pattern
2. **Descriptive test names** that explain the scenario
3. **One assertion per test** when possible
4. **Mock external dependencies**
5. **Test both success and failure cases**

### Test Organization:
1. **Group related tests** in the same class
2. **Use `@BeforeEach`** for setup
3. **Use `@AfterEach`** for cleanup
4. **Use `@Order`** for integration tests
5. **Use `@DisplayName`** for readable test names

### Performance:
1. **Keep unit tests fast** (< 1 second)
2. **Use mocks** instead of real services
3. **Clean up resources** after tests
4. **Avoid file I/O** in unit tests
5. **Use `@TempDir`** for file operations

## Contributing

### Adding New Tests:
1. Create test class in appropriate package
2. Follow naming convention: `ClassNameTest.java`
3. Add test methods with descriptive names
4. Update this documentation if needed

### Test Requirements:
- All new code must have corresponding tests
- Tests must pass before merging
- Coverage must not decrease
- Integration tests must be added for new features

## Resources

- [JUnit 5 Documentation](https://junit.org/junit5/docs/current/user-guide/)
- [Mockito Documentation](https://javadoc.io/doc/org.mockito/mockito-core/latest/org/mockito/Mockito.html)
- [Maven Surefire Plugin](https://maven.apache.org/surefire/maven-surefire-plugin/)
- [JaCoCo Documentation](https://www.jacoco.org/jacoco/trunk/doc/)
